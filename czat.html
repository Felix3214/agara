<!doctype html>
<html lang="pl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Czat</title>
    <style>
        :root{
            --panel-height:84px;
            --gap:24px;
            --container-width:80%;
            --box-bg: rgba(255,255,255,0.85);
            --box-radius:10px;
        }
        html,body{
            height:100%;
            margin:0;
        }
        body{
            min-height:100vh;
            background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='8' height='8'><rect width='8' height='1' y='0' fill='%23ff3b30'/><rect width='8' height='1' y='1' fill='%23ff9500'/><rect width='8' height='1' y='2' fill='%23ffd60a'/><rect width='8' height='1' y='3' fill='%2390ff3e'/><rect width='8' height='1' y='4' fill='%23009aff'/><rect width='8' height='1' y='5' fill='%239b59ff'/><rect width='8' height='1' y='6' fill='%23ff2d95'/><rect width='8' height='1' y='7' fill='%23ff7ab6'/></svg>");
            background-size:500px 500px;
            background-repeat: repeat;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            display:flex;
            flex-direction:column;
        }
        header{
            height:var(--panel-height);
            display:flex;
            align-items:center;
            justify-content:center;
            padding:0 20px;
            box-sizing:border-box;
            backdrop-filter: blur(2px);
            background: linear-gradient(180deg, rgba(255,255,255,0.75), rgba(255,255,255,0.6));
            border-bottom: 1px solid rgba(0,0,0,0.08);
            position:relative;
        }
        header .theme-toggle{
            position:absolute;
            right:12px;
            top:10px;
            border-radius:8px;
            padding:6px 10px;
            border:1px solid rgba(0,0,0,0.06);
            background:rgba(255,255,255,0.9);
            cursor:pointer;
            font-size:0.95rem;
        }
        header h1{
            margin:0;
            font-size:1.1rem;
            color:#222;
        }
        nav {
            display: flex;
            gap: 20px;
        }
        nav a {
            text-decoration: none;
            color: #222;
            font-weight: 500;
            font-size: 1.1rem;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.2s;
        }
        nav a:hover {
            background: rgba(0,0,0,0.05);
            color: var(--accent-color);
        }
        header {
            height: var(--panel-height);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 40px;
            box-sizing: border-box;
            backdrop-filter: blur(2px);
            background: linear-gradient(180deg, rgba(255,255,255,0.75), rgba(255,255,255,0.6));
            border-bottom: 1px solid rgba(0,0,0,0.08);
            position: relative;
            z-index: 10;
        }
        main{
            flex:1;
            position:relative;
        }
        .bottom-row{
            top: calc(var(--panel-height) + 20px);
            grid-auto-rows: 1fr;
            position:absolute;
            left:50%;
            transform:translateX(-50%);
            bottom:36px;
            width:980px;
            max-width:980px;
            display:grid;
            grid-template-columns: 220px 480px 280px;
            gap:var(--gap);
            align-items:start;
            pointer-events:auto;
        }
        .box{
            min-height:320px;
            background:var(--box-bg);
            border-radius:var(--box-radius);
            box-shadow: 0 6px 18px rgba(0,0,0,0.12);
            display:flex;
            align-items:center;
            justify-content:center;
            color:#111;
            font-size:0.95rem;
        }
        .box.transparent{
            background: rgba(255,255,255,0.35);
            border: 10px solid rgba(255,255,255,0.25);
            color:#062;
            backdrop-filter: blur(5px);
        }
        @media (max-width:800px){
            .bottom-row{
                width:92%;
                grid-template-columns: 1fr;
                bottom:20px;
            }
            .box{ min-height:320px; }
        }
        body.night{
            background-image: none;
            background-color: #050a1a;
            background-size:200px 200px;
            background-repeat: repeat;
            image-rendering: pixelated;
            color: #e6f7d9;
        }
        body.night .box{
            background: rgba(49, 56, 70, 0.56);
            color: #e6f7d9;
            border: 5px solid rgba(129, 93, 93, 0.02);
        }
        body.night .box.transparent{
            background: rgba(39, 38, 43, 0.45);
            border: 10px solid rgba(0,0,0,0.08);
            color: #e8f09e;
            backdrop-filter: none;
        }
        body.night header{
            background: linear-gradient(180deg, rgba(9, 13, 27, 0.85), rgba(15, 29, 68, 0.9));
            border-bottom-color: rgba(255,255,255,0.03);
        }
        body.night header .theme-toggle{
            background: rgba(255,255,255,0.03);
            color: #cffff0;
            border:1px solid rgba(255,255,255,0.04);
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <a href="muzyka.html">muzyka</a>
            <a href="czat.html" class="active">CZAT</a>
            <a href="ogolne.html">ogolne</a>
        </nav>
        <button id="themeToggle" class="theme-toggle" title="PrzeÅ‚Ä…cz motyw">ðŸŒž</button>
    </header>
    <main>
        <div class="bottom-row" aria-label="Dolne przedziaÅ‚ki">
            <section class="box transparent" id="left">
                <div style="width:100%">
                    
                    <div style="text-align:center;color:#666"></div>
                </div>
            </section>
            <section class="box" id="center">
                <div style="width:100%;max-width:420px;margin:0 auto;display:flex;flex-direction:column;align-items:stretch;gap:18px;">
                    <h2 style="text-align:center">Czat online</h2>
                    <div id="chat-messages" style="background:#fff; color:#222; border-radius:8px; min-height:180px; max-height:260px; overflow-y:auto; box-shadow:0 2px 8px rgba(0,0,0,0.06); padding:12px 10px; font-size:1.01rem; margin-bottom:8px;"></div>
                    <form id="chat-form" style="display:flex;gap:8px;align-items:center;">
                        <input id="chat-input" type="text" placeholder="Napisz wiadomoÅ›Ä‡..." autocomplete="off" style="flex:1; padding:8px 12px; border-radius:8px; border:1px solid #ccc; font-size:1.05rem;" />
                        <button type="submit" style="padding:8px 18px; border-radius:8px; border:none; background:#009aff; color:#fff; font-weight:bold; font-size:1.05rem; cursor:pointer;">WyÅ›lij</button>
                    </form>
                    
            </section>
            <section class="box transparent" id="right">
                <div style="width:100%;text-align:center;color:#666">
                    </div>
            </section>
        </div>
    </main>
    <script>
        (function(){
            // Motyw noc/dzieÅ„ (bez zmian)
            const themeToggle = document.getElementById('themeToggle');
            (function(){
                try{
                    const saved = localStorage.getItem('theme') || 'day';
                    const startNight = saved === 'night';
                    if(startNight) document.body.classList.add('night');
                    let nightCanvas = null;
                    let nightCtx = null;
                    let nightStars = [];
                    let nightAnim = null;
                    function resizeNightCanvas(){
                        if(!nightCanvas) return;
                        const dpr = window.devicePixelRatio || 1;
                        nightCanvas.width = Math.floor(window.innerWidth * dpr);
                        nightCanvas.height = Math.floor(window.innerHeight * dpr);
                        nightCanvas.style.width = window.innerWidth + 'px';
                        nightCanvas.style.height = window.innerHeight + 'px';
                        if(nightCtx) nightCtx.setTransform(dpr,0,0,dpr,0,0);
                    }
                    function generateStars(){
                        nightStars = [];
                        const count = 50;
                        for(let i=0;i<count;i++){
                            nightStars.push({
                                x: Math.random() * window.innerWidth,
                                y: Math.random() * window.innerHeight,
                                r: (Math.random() * 1.2) + 0.3,
                                base: 0.25 + Math.random() * 0.6,
                                freq: 0.6 + Math.random() * 1.8,
                                phase: Math.random() * Math.PI * 2,
                                flick: 0.2 + Math.random() * 0.6
                            });
                        }
                    }
                    function drawNight(t){
                        if(!nightCtx) return;
                        const w = window.innerWidth, h = window.innerHeight;
                        nightCtx.clearRect(0,0,w,h);
                        const time = t * 0.001;
                        for(let s of nightStars){
                            const a = Math.max(0, Math.min(1, s.base * (0.6 + 0.4 * Math.sin(time * s.freq + s.phase))));
                            const alpha = a * s.flick;
                            nightCtx.fillStyle = 'rgba(255,240,120,' + alpha + ')';
                            const cx = Math.round(s.x);
                            const cy = Math.round(s.y);
                            const arm = 1;
                            nightCtx.shadowBlur = Math.max(0, s.r * 2);
                            nightCtx.shadowColor = 'rgba(255,240,120,' + (alpha * 0.9) + ')';
                            nightCtx.fillRect(cx, cy, 1, 1);
                            nightCtx.fillRect(cx - arm, cy, arm, 1);
                            nightCtx.fillRect(cx + 1, cy, arm, 1);
                            nightCtx.fillRect(cx, cy - arm, 1, arm);
                            nightCtx.fillRect(cx, cy + 1, 1, arm);
                            nightCtx.shadowBlur = 0;
                        }
                        nightAnim = requestAnimationFrame(drawNight);
                    }
                    function ensureNightCanvas(){
                        if(nightCanvas) return;
                        nightCanvas = document.createElement('canvas');
                        nightCanvas.className = 'night-canvas';
                        nightCanvas.style.position = 'fixed';
                        nightCanvas.style.left = '0';
                        nightCanvas.style.top = '0';
                        nightCanvas.style.width = '100%';
                        nightCanvas.style.height = '100%';
                        nightCanvas.style.pointerEvents = 'none';
                        nightCanvas.style.zIndex = '0';
                        nightCanvas.style.mixBlendMode = 'screen';
                        document.body.appendChild(nightCanvas);
                        nightCtx = nightCanvas.getContext('2d');
                        window.addEventListener('resize', resizeNightCanvas);
                        resizeNightCanvas();
                        generateStars();
                        if(nightAnim) cancelAnimationFrame(nightAnim);
                        nightAnim = requestAnimationFrame(drawNight);
                    }
                    function removeNightCanvas(){
                        if(nightAnim) cancelAnimationFrame(nightAnim);
                        nightAnim = null;
                        if(nightCanvas){ try{ nightCanvas.remove(); }catch(e){} }
                        nightCanvas = null; nightCtx = null; nightStars = [];
                    }
                    if(themeToggle){
                        themeToggle.textContent = document.body.classList.contains('night') ? 'ðŸŒ™' : 'ðŸŒž';
                        themeToggle.addEventListener('click', ()=>{
                            const isNight = document.body.classList.toggle('night');
                            localStorage.setItem('theme', isNight ? 'night' : 'day');
                            themeToggle.textContent = isNight ? 'ðŸŒ™' : 'ðŸŒž';
                            if(isNight) ensureNightCanvas(); else removeNightCanvas();
                        });
                    }
                    if(startNight) ensureNightCanvas();
                }catch(e){ /* ignore */ }
            })();

            // --- CHAT WEBSOCKET ---
            const chatMessages = document.getElementById('chat-messages');
            const chatForm = document.getElementById('chat-form');
            const chatInput = document.getElementById('chat-input');
            let ws = null;
            function addMessage(msg, isOwn) {
                const div = document.createElement('div');
                div.textContent = msg;
                div.style.margin = '2px 0 2px 0';
                div.style.wordBreak = 'break-word';
                if(isOwn) div.style.color = '#009aff';
                chatMessages.appendChild(div);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            function connect() {
                ws = new WebSocket('ws://' + window.location.hostname + ':8765');
                ws.onopen = function() {
                    addMessage('[PoÅ‚Ä…czono z czatem]', false);
                };
                ws.onmessage = function(e) {
                    addMessage(e.data, false);
                };
                ws.onclose = function() {
                    addMessage('[RozÅ‚Ä…czono z serwerem]', false);
                    setTimeout(connect, 2000);
                };
                ws.onerror = function() {
                    ws.close();
                };
            }
            connect();
            chatForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const msg = chatInput.value.trim();
                if(msg && ws && ws.readyState === 1) {
                    ws.send(msg);
                    addMessage(msg, true);
                    chatInput.value = '';
                }
            });
        })();
    </script>
</body>
</html>
